<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Image2Cartoon by: Aahedi</title>
<meta name='description' content='Convert Image to Cartoon'>
<meta name='author' content='Aahedi'>
<link rel="shortcut icon" type="image/png" href="data:image/png;base64,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">
<style>
    body {
        background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='240px' width='330px'> \
    <rect x='5' y='5%' rx='25' width='320' height='200' style='stroke:white; fill:#aaa; fill-opacity: 0.1; stroke-width: 5px;stroke-dasharray:10; stroke-linecap=round; '/> \
    <text x='15%' y='40%' fill='white' font-size='40'>Drop/Paste or</text> \
    <text x='15%' y='60%' fill='white' font-size='40'>Select Image</text></svg>");
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-position: center;
        background-color: #ccc;
		width: 100%;
		padding: 0;
		margin: 0;
    }
    
    .content {
        width: 100%;
        height: 100%;
        top: 15%;
        left: 25% right: 25%;
        text-align: center;
        position: fixed;
		user-select: none;
    }
    
    .content #image {
        height: 70%;
        z-index: 1;
        position: relative;
		max-width: -webkit-fill-available;
    }
    
    #file-upload {
        top: -30%;
        position: relative;
    }
    
    .upload {
        top: -40.5%;
        position: relative;
        background: rgba(255, 255, 255, 0);
        padding: 100px 165px;
        left: 15px;
	background: url(data:image/png;base64,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);
    background-repeat: no-repeat;
    background-position: center center;
    }
</style>

<body>
    <div class='content'>
        <img id="image1" hidden/>
        <img id="image2" hidden/>
        <img id="image3" hidden/>
        <img id="image" />
        <br>
        <br>
        <input id="file-upload" type="file" accept="image/*" hidden/>
        <label for="file-upload" class="upload"></label>
    </div>
	<script src="downscale.js"></script>
	<script src="glfx.js"></script>
    <script>
        function gbr_ink(sourceID, resultID) {
            var canvas = fx.canvas();
            var texture = canvas.texture(document.getElementById(sourceID));
            canvas.draw(texture).ink(0.35).update();
            var image = new Image;
            document.getElementById(resultID).src = canvas.toDataURL();
            //document.getElementById(sourceID).parentNode.insertBefore(canvas, document.getElementById(sourceID)); //jika disimpan di canvas
        };

        function gbr_denoise(sourceID, resultID) {
            var canvas = fx.canvas();
            var texture = canvas.texture(document.getElementById(sourceID));
            canvas.draw(texture).denoise(50).update();
            var image = new Image;
            document.getElementById(resultID).src = canvas.toDataURL();
        };

        function gbr_contrast(sourceID, resultID) {
            var canvas = fx.canvas();
            var texture = canvas.texture(document.getElementById(sourceID));
            canvas.draw(texture).brightnessContrast(0.1, 0.2).update();
            var image = new Image;
            document.getElementById(resultID).src = canvas.toDataURL();

            setTimeout(function() {
                gbr_denoise('image2', 'image3')
            }, 2);

            setTimeout(function() {
                gbr_ink('image3', 'image')
            }, 4);

            setTimeout(function() {
                hapus_atr('#image1', 'src');
                hapus_atr('#image2', 'src');
                hapus_atr('#image3', 'src');
            }, 6);
        };

        function hapus_atr(elem, att) {
            var els = document.querySelectorAll(elem);
            for (var i = 0; i < els.length; i++) {
                els[i].removeAttribute(att);
            }
        }

        document.body.addEventListener("mouseover", function(event) {
            document.body.style.backgroundColor = '#ccc';

            document.body.onpaste = function(event) {
                hapus_atr('image', 'src');
                // use event.originalEvent.clipboard for newer chrome versions
                var items = (event.clipboardData || event.originalEvent.clipboardData).items;
                //console.log(JSON.stringify(items)); // will give you the mime types
                // find pasted image among pasted items
                var blob = null;
                for (var i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf("image") === 0) {
                        blob = items[i].getAsFile();
                    }
                }
                // load image if there is a pasted image
                if (blob !== null) {
                    var reader = new FileReader();
                    reader.onload = function(event) {
                        //console.log(event.target.result); // data url!
                        var lgbr = event.target.result;
                        document.getElementById("image1").src = lgbr;

                        setTimeout(function() {
                            gbr_contrast('image1', 'image2');
                        }, 2);
                        //addNote(lgbr);
                    };
                    reader.readAsDataURL(blob);
                }
            }
        });
        document.body.addEventListener("mouseout", function(event) {
            //document.body.style.backgroundColor = '#ddd';
        });

        document.addEventListener('DOMContentLoaded', function() {
            var handleDrag = function(e) {
                hapus_atr('image', 'src');
                //kill any default behavior
                e.stopPropagation();
                e.preventDefault();
            };
            var handleDrop = function(e) {
                //kill any default behavior
                e.stopPropagation();
                e.preventDefault();
                //console.log(e);
                //get x and y coordinates of the dropped item
                x = e.clientX;
                y = e.clientY;
                //drops are treated as multiple files. Only dealing with single files right now, so assume its the first object you're interested in
                var file = e.dataTransfer.files[0];
                //don't try to mess with non-image files
                if (file.type.match('image.*')) {
                    //then we have an image,

                    //we have a file handle, need to read it with file reader!
                    var reader = new FileReader();

                    // Closure to capture the file information.
                    reader.onload = (function(theFile) {
                        //get the data uri
                        var dataURI = theFile.target.result;
                        //make a new image element with the dataURI as the source
                        // var img = document.createElement("img");
                        // img.src = dataURI;

                        var img = document.getElementById('image1');
                        img.src = dataURI;

                        //Insert the image at the carat

                        // Try the standards-based way first. This works in FF
                        if (document.caretPositionFromPoint) {
                            var pos = document.caretPositionFromPoint(x, y);
                            range = document.createRange();
                            range.setStart(pos.offsetNode, pos.offset);
                            range.collapse();
                            range.insertNode(img);
                        }
                        // Next, the WebKit way. This works in Chrome.
                        else if (document.caretRangeFromPoint) {
                            range = document.caretRangeFromPoint(x, y);
                            range.insertNode(img);
                        } else {
                            //not supporting IE right now.
                            console.log('could not find carat');
                        }

                        setTimeout(function() {
                            gbr_contrast('image1', 'image2');
                        }, 2);

                    });
                    //this reads in the file, and the onload event triggers, which adds the image to the div at the carat
                    reader.readAsDataURL(file);
                }
            };

            var dropZone = document.body;
            dropZone.addEventListener('dragover', handleDrag, false);
            dropZone.addEventListener('drop', handleDrop, false);

            //Fungsi tombol upload			    
            var readURL = function(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
					  var img = new Image();

					  img.onload = function() {
						var canvas = document.createElement('canvas');
						var ctx = canvas.getContext('2d');
						canvas.width = 640;
						canvas.height = canvas.width * (img.height / img.width);
						ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
						var data = canvas.toDataURL('image/png');
						
										document.getElementById('image1').src = data;

										setTimeout(function() {
											gbr_contrast('image1', 'image2');
										}, 2);
									}
					  img.src = e.target.result;
					}

                    reader.readAsDataURL(input.files[0]);
                }
            }

            document.getElementById('file-upload').addEventListener('change', function() {
                readURL(this);
				//filesChanged(this.files)
            });
            /*document.getElementById('upload-button').addEventListener('click', function () {
        readURL(this);
	});*/
        });
		
function filesChanged(files){
  for (var i = 0; i < files.length; i++) {
    downscale(files[i], 720, 0).
    then(function(dataURL) {
                        document.getElementById('image1').src = dataURL;

                        setTimeout(function() {
                            gbr_contrast('image1', 'image2');
                        }, 2);
	  
    })
  }
}
    </script>
</body>
</html>
